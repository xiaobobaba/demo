<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>我的生活</title>
<meta name="viewport" content="initial-scale=1, maximum-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<style type="text/css">
</style>
<link rel="stylesheet" href="../js/layui/css//layui.css"  media="all"><!--前端框架  -->
<link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
<link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css">

</head>
<body>
		<!-- 单个page ,第一个.page默认被展示-->
		<div class="page page-current" id="page">
			<!-- 标题栏 -->
			<header class="bar bar-nav">
				<a class="icon icon-me pull-left open-panel"></a>
				<h1 class="title">卡片</h1>
			</header>
			<!-- 工具栏 -->
			<nav class="bar bar-tab">
				<a class="tab-item external active" href="#"><i class="layui-icon">&#xe68e;</i></a> 
				<a class="tab-item" href="#router3"><i class="layui-icon">&#xe654;</i></a>
				<a class="tab-item" href="#"><i class="layui-icon">&#xe66f;</i></a>
			</nav>
			<div class="content" id="contain" data-toggle="scroller">
			</div>
		</div>
	<div class="page" id='router3'>
		<header class="bar bar-nav">
			<a class="button button-link button-nav pull-left back"
				href="/docs-demos/router"> <span class="icon icon-left"></span>
				返回
			</a>
		</header>
		<div class="content">
			<div class="card facebook-card">
				<form action="user/add" name="user" id="add_form">
					<!-- 这里是页面内容区 -->
					<div class="list-block">
						<!-- <ul>
						<li>
								<div class="item-input">
									<textarea name="zwjs" id="zwjs"></textarea>
								</div>
							</li>
						</ul> -->
						<div class="card-header no-border">
							<div class="facebook-avatar">
								<img src="/1.jpg" width="34" height="34">
							</div>
							<div class="facebook-name">肖博</div>
							<div class="facebook-date"><input type="text"  placeholder="卡片标题" style="height=18px;"/></div>
						</div>
						<div class="card-content-content">
							<textarea name="zwjs" id="zwjs" placeholder="卡片内容"></textarea>
						</div>
						<div class="card-content">
							<div class="layui-upload" >
								<p id="test2">&nbsp<i class="layui-icon" >&#xe60d;</i>选择图片：</p>
									<ul id="demo2">
									<li id="li1"  style='display: flex;flex-direction:row;flex-wrap:wrap;align-content: space-between;height:5rem;'>
									</li>
									<li id="li2" style='display: flex;flex-direction:row;flex-wrap:wrap;align-content: space-between;width:33.333%;height:33.333%;'>
									</li>
									<li id="li3" style='display: flex;flex-direction:row;flex-wrap:wrap;align-content: space-between;width:33.333%;height:33.333%;'>
									</li>
									</ul>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- popup, panel 等放在这里 -->
		<div class="panel-overlay"></div>
		<!-- Left Panel with Reveal effect -->
		<div class="panel panel-left panel-reveal">
			<div class="content-block">
				<p>这是一个侧栏</p>
				<p></p>
				<!-- Click on link with "close-panel" class will close panel -->
				<p>
					<a href="#" class="close-panel">关闭</a>
				</p>
			</div>
		</div>
		<script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
		<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
		<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js' charset='utf-8'></script>
		<script type='text/javascript' src='../js/public.js' charset='utf-8'></script>
		<script type='text/javascript' src='index.js' charset='utf-8'></script>
		<script type='text/javascript' src='../js/layui/layui.all.js' charset='utf-8'></script>
	<script type="text/javascript">
	
	var indexAll ={
			all : function(indexId){
				var params =[{name : "cardId", value: indexId}];
				var list = null;
				ajax('//xiaobo.nat300.top/userCard/findUserCardById',
						params, function(data) {
							isTK(data);
							if (data.success) {
								if(data.list == null){
									tankuang("失败");
								}else{
									list = data.list;
									var html ='';
									html += /*头像  */ '<div class = "popup">'
						  				+'<div class="card facebook-card">'
										+'<div class="card-header no-border">'
										+'<div class="facebook-avatar">'
										+'<img src="'+list[0].touXiang+'" width="34" height="34">'
										+'</div>'
										//标签
										+'<div class="facebook-name">'+list[0].name+'</div>'
										+'<div class="facebook-date">'+list[0].cardTitle+'</div>'
										+'</div>'
										//主体
										+'<div class="card-content">'
										+'<img src="'+list[0].cardImg+'" width="100%">'
										+'</div>'
										//主题内容
										+'<div class="card-content-inner">'//list[0].createTime
										+'<p class="color-gray">发表于 '+format(list[0].createTime)+'</p>'
										+'<p>内容：'+(list[0].cardContent||'')+'</p>'
										+'<p>评论：'+(list[0].commentContent||'')+'</p>'
										+'</div>'
										//最下层 
										+'<div class="card-footer no-border">'
										+'<a href="#" class="link">赞</a> <a href="#" class="link">评论</a>'
										+'<a href="#" class="close-popup">返回</a>'
										+'</div>'
										+'</div></div>';
										$.popup(html);
								}
							}
						},false);
			},
	}
	var imgCount = 1;
	layui.use('upload', function(){
		  var $ = layui.jquery
		  ,upload = layui.upload;
		//多图片上传
		  upload.render({
		    elem: '#test2'
		    ,url: '/upload/'
		    ,multiple: true
		    ,async: true
		    ,before: function(obj){
		      //预读本地文件示例，不支持ie8
		      obj.preview(function(index, file, result){
		    	  if(imgCount > 9){
		    		  tankuang("最多可选9张图片");
		    	  }else if(imgCount <= 3 || imgCount > 0){
			        	$('#li1').append('<img style="width:33%;height:100%;" src="'+ result +'" alt="'+ file.name +'" >')
		    	  }else if(imgCount <= 6 || imgCount > 3){
		    		  $('#li2').append('<img style="width:33%;height:100%;" src="'+ result +'" alt="'+ file.name +'" ');
		    	  }else if(imgCount <= 9 || imgCount > 6){
		    		  $('#li3').append('<img style="width:33%;height:100%;" src="'+ result +'" alt="'+ file.name +'" ');
		    	  }else{
		    		  tankuang("最多可选9张图片");
		    	  }
		    	  	imgCount = imgCount+1;
		      });
		    }
		    ,done: function(res){
		      //上传完毕
		    }
		  });
	});
		$(function() {
			//开始条数
			var startInd = 0;
			//每次查询条数
			var index = 3;
			//最大条数
			var maxIndex = 0;
			//高度
			var heig = 0;
			//预先加载3条
			var params =[{name : "startIndex", value: startInd},{name : "index", value: index+1}];
			ajax('//xiaobo.nat300.top/userCard/findUserCard', params, function(data) {
				isTK(data);
				if (data.success) {
					maxIndex = data.total;
					console.log(maxIndex)
					addItems(data.list);
				}
			});
			//加载新的卡片
			function addItems(list) {
				// 生成新条目的HTML
				var html = '';
				for (var i = 0 ; i < list.length; i++) {
					startInd = startInd + 1;
					if(list[i].commentContent != null && list[i].commentContent !=''){
						var str = list[i].commentContent.substr(0,10);
					}
					html += /*头像  */ 
		  				'<div class="card facebook-card" id="all'+i+'">'
						+'<div class="card-header no-border">'
						+'<div class="facebook-avatar">'
						+'<img src="'+list[i].touXiang+'" width="34" height="34">'
						+'</div>'
						//标签
						+'<div class="facebook-name">'+list[i].name+'</div>'
						+'<div class="facebook-date">'+list[i].cardTitle+'</div>'
						+'</div>'
						//主体
						+'<div class="card-content">'
						+'<img src="'+list[i].cardImg+'" width="100%">'
						+'</div>'
						//主题内容
						+'<div class="card-content-inner">'//list[0].createTime
						+'<p class="color-gray">发表于 '+format(list[i].createTime)+'</p>'
						+'<p>内容：'+(list[i].cardContent.substr(0,10)||'')+'</p>'
						+'<p>评论：'+(str||'')+'</p>'
						+'</div>'
						//最下层 
						+'<div class="card-footer no-border">'
						+'<a href="#" class="link">赞</a> <a href="#" class="link">评论</a>'
						+'<a href="javascript:indexAll.all('+list[i].cardId+')" class="close-popup">更多</a>'
						+'</div>'
						+'</div>';
					}
				// 添加新条目
				$('#contain').append(html);
			}
			//滚动条加载监听事件
			$(".content").on(
					'scroll',
					function() {
						var h = Math.max(document.documentElement.clientHeight,
								document.body.clientHeight);
						if ($('.content').scrollTop() > h + heig) {
							var params =[{name : "startIndex", value: startInd+1},{name : "index", value: index}];
							ajax('//xiaobo.nat300.top/userCard/findUserCard',
									params, function(data) {
										isTK(data);
										console.log(startInd)
										if (data.success) {
											if(maxIndex <= startInd+3){
												startInd =0;
												startInd = 0;
											}
											addItems(data.list);
											heig = heig + 1200;
										}
									},false);
							$.refreshScroller();
						}
					});
		});
	</script>
</body>
</html>