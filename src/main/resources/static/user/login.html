<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>肖仙森的项目</title>
<meta name="viewport" content="initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes"><!--前端框架  -->
<meta name="apple-mobile-web-app-status-bar-style" content="black"><!--前端框架  -->
<link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css"><!--前端框架  -->
<link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css"><!--前端框架  -->
<link href="../css/zzsc.css" rel="stylesheet" type="text/css"><!--大转盘  -->
</head>
<body>
	<!-- page集合的容器，里面放多个平行的.page，其他.page作为内联页面由路由控制展示 -->
	<div class="page-group">
		<!-- 单个page ,第一个.page默认被展示-->
		<div class="page">
			<!-- 标题栏 -->
			<header class="bar bar-nav">
				<a class="icon icon-me pull-left open-panel"></a>
				<h1 class="title">肖仙森的项目</h1>
			</header>
			<!-- 工具栏 -->
			<nav class="bar bar-tab" ><!-- style="position: absolute;" -->
					<a class="tab-item external active" href="#"> <span
						class="icon icon-home"></span> <span class="tab-label">首页</span>
					</a> <a class="tab-item external" href="#"> <span
						class="icon icon-star"></span> <span class="tab-label">收藏</span>
					</a> <a class="tab-item external" href="#"> <span
						class="icon icon-settings"></span> <span class="tab-label">设置</span>
					</a>
			</nav>
			<div class="content">
				<div class="buttons-tab">
					<a href="#tab1" class="tab-link button">登录</a> 
					<a href="#tab2" class="tab-link active button">注册</a> 
					<a href="#tab3" class="tab-link button">吃什么</a>
				</div>
				<div class="content-content">
					<div class="tabs">
						<div id="tab1" class="tab">
							<div class="content-block">
								<p>This is tab 1 content</p>
							</div>
						</div>
						<div id="tab3" class="tab">
							<div class="content-block">
								<img src="" id="fen-img" style="display: none;" />
								<img src="" id="zuliao-img" style="display: none;" /> 
								<img src="" id="baowen-img" style="display: none;" /> 
								<img src="" id="yundou-img" style="display: none;" />
								<img src="" id="ganlan-img" style="display: none;" /> 
								<img src="" id="yusan-img" style="display: none;" />
								<div class="banner">
									<div class="turnplate">
										<canvas class="item" id="wheelcanvas" width="422px"
											height="422px"></canvas>
										<img class="pointer" src="../images/turnplate-pointer.png">
									</div>
								</div>
							</div>
						</div>
						<div id="tab2" class="tab active">
						<div class="card">
							<!-- <input type="file" accept="image/*" id="txt" /> -->
						</div>
							<div class="card facebook-card">
							<form action="user/add" name="user" id="login_form">
									<!-- 这里是页面内容区 -->
									<div class="list-block">
										<ul>
											<li class="item-content">
												<div class="item-media">
													<input type="file" accept="image/*" id="file-input" name="fileContent" hidden="true">
													<img id="img_import" 
														src="/1.jpg"
														width="44" style="position: relative;left:  40px;left: 15px position:absolute;">
												</div>
												<div class="item-inner">
													<div class="item-title-row">
														<div class="item-title" style="margin-left: 3.8rem;"><a href="javascript: login.img_import()" class="link">点击选择头像</a></div>
														<div class="item-subtitle" style="margin-left: 4.5rem;"><a id="imgName" href="javascript: login.img_import()" class="link">默认头像.jpg</a></div>
													</div>
												</div>
											</li>
											<!-- <li><img src="/images/2.jpg" width="40px" height="40px" style="position: relative;left: 40px;top: 10px;position:absolute;">
												<div class="item-title">点击图片选择头像</div>
												<div class="item-subtitle">2.jpg</div>
												<div class="facebook-name" style="margin-left: 7.2rem;"><p></p>点击图片选择头像</div>
												<div class="facebook-date" style="margin-left: 8.2rem;">2.jpg</div>
											</li> -->
											<!-- Text inputs -->
											<li>
												<div class="item-content">
													<div class="item-media">
														<i class="icon icon-form-name"></i>
													</div>
													<div class="item-inner">
														<span class="icon icon-card"></span>&nbsp &nbsp
														<div class="item-title label">姓名</div>
														<div class="item-input">
															<input type="text" placeholder="Your name" id="userName"
																name="name">
														</div>
													</div>
												</div>
											</li>
											<li>
												<div class="item-content">
													<div class="item-media">
														<i class="icon icon-form-email"></i>
													</div>
													<div class="item-inner">
													<div class="item-media">
													</div>
													&nbsp<i class="icon icon-form-email">@</i>&nbsp&nbsp
														<div class="item-title label">邮箱</div>
														<div class="item-input">
															<input type="email" placeholder="E-mail" name="email"
																id="email">
														</div>
													</div>
												</div>
											</li>
											<li>
												<div class="item-content">
													<div class="item-media">
														<i class="icon icon-form-password"></i>
													</div>
													<div class="item-inner">
													<div class="item-media">
													<span class="icon icon-me"></span>&nbsp&nbsp
													</div>
														<div class="item-title label">密码</div>
														<div class="item-input">
															<input type="password" placeholder="Password" class=""
																name="password" id="passWord">
														</div>
													</div>
												</div>
											</li>
											<li>
												<div class="item-content">
													<div class="item-media">
														<i class="icon icon-form-gender"></i>
													</div>
													<div class="item-inner">
													<div class="item-media">
													<span class="icon icon-me"></span>&nbsp&nbsp
													</div>
														<div class="item-title label">性别</div>
														<div class="item-input">
															<select name="sex" id="sex">
																<option value="男">男</option>
																<option value="女">女</option>
															</select>
														</div>
													</div>
												</div>
											</li>
											<!-- Date -->
											<li>
												<div class="item-content">
													<div class="item-media">
														<i class="icon icon-form-calendar"></i>
													</div>
													<div class="item-inner">
													<div class="item-media">
													<span class="icon icon-me"></span>&nbsp&nbsp
													</div>
														<div class="item-title label">生日</div>
														<div class="item-input">
															<input type="date" placeholder="Birth day"
																value="2014-04-30" id="birthDay" name="birthDay">
														</div>
													</div>
												</div>
											</li>
											<!-- Switch (Checkbox) -->
											<li>
												<div class="item-content">
													<div class="item-media">
														<i class="icon icon-form-toggle"></i>
													</div>
													<div class="item-inner">
													<div class="item-media">
													<span class="icon icon-me"></span>&nbsp&nbsp
													</div>
														<div class="item-title label">开关</div>
														<div class="item-input">
															<label class="label-switch"> <input
																type="checkbox">
																<div class="checkbox"></div>
															</label>
														</div>
													</div>
												</div>
											</li>
											<li class="align-top">
												<div class="item-content">
													<div class="item-media">
														<i class="icon icon-form-comment"></i>
													</div>
													<div class="item-inner">
													<div class="item-media">
														<span class="icon icon-message"></span>&nbsp
													</div>
														<div class="item-title label">自我介绍</div>
														<div class="item-input">
															<textarea name="zwjs" id="zwjs"></textarea>
														</div>
													</div>
												</div>
											</li>
											<li><a href="#" class="item-link list-button">注册</a></li>
										</ul>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- 其他的单个page内联页（如果有） -->
			<div class="page">...</div>
		</div>
	</div>


	<!-- popup, panel 等放在这里 -->
	<div class="panel-overlay"></div>
	<!-- Left Panel with Reveal effect -->
	<div class="panel panel-left panel-reveal">
		<div class="content-block">
			<p>这是一个侧栏</p>
			<p></p>
			<!-- Click on link with "close-panel" class will close panel -->
			<p>
				<a href="#" class="close-panel">关闭</a>
			</p>
		</div>
	</div>
	<script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script><!--前端框架  -->
	<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script><!--前端框架  -->
	<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js' charset='utf-8'></script><!--前端框架  -->
	<script type='text/javascript' src='login.js' charset='utf-8'></script>
	<script type='text/javascript' src='../js/common/jquery/jquery1.8.3.min.js' charset='utf-8'></script>
	<script type='text/javascript' src='../js/public.js' charset='utf-8'></script>
	<script type="text/javascript" src="../js/awardRotate.js"></script><!--大转盘  -->
	<script type="text/javascript">
var turnplate={
		restaraunts:[],				//大转盘奖品名称
		colors:[],					//大转盘奖品区块对应背景颜色
		outsideRadius:210,			//大转盘外圆的半径
		textRadius:150,				//大转盘奖品位置距离圆心的距离
		insideRadius:60,			//大转盘内圆的半径
		startAngle:0,				//开始角度
		bRotate:false				//false:停止;ture:旋转
};

$(document).ready(function(){
	//动态添加大转盘的奖品与奖品区域背景颜色
	turnplate.restaraunts = ["吃啥吃，减肥", "大食堂", "汤面", "粉", "砂锅米饭", "饺子", "粥 ", "干拌粉", "沙拉", "拌面"];
	turnplate.colors = ["#FFF4D6", "#FFFFFF", "#FFF4D6", "#FFFFFF","#FFF4D6", "#FFFFFF", "#FFF4D6", "#FFFFFF","#FFF4D6", "#FFFFFF"];
	var rotateTimeOut = function (){
		$('#wheelcanvas').rotate({
			angle:0,
			animateTo:2160,
			duration:8000,
			callback:function (){
				alert('网络超时，请检查您的网络设置！');
			}
		});
	};

	//旋转转盘 item:奖品位置; txt：提示语;
	var rotateFn = function (item, txt){
		var angles = item * (360 / turnplate.restaraunts.length) - (360 / (turnplate.restaraunts.length*2));
		if(angles<270){
			angles = 270 - angles; 
		}else{
			angles = 360 - angles + 270;
		}
		$('#wheelcanvas').stopRotate();
		$('#wheelcanvas').rotate({
			angle:0,
			animateTo:angles+1800,
			duration:8000,
			callback:function (){
				//中奖提示
				alert("等会吃："+txt);
				turnplate.bRotate = !turnplate.bRotate;
			}
		});
	};

	$('.pointer').click(function (){
		if(turnplate.bRotate)return;
		turnplate.bRotate = !turnplate.bRotate;
		//获取随机数(奖品个数范围内)
		var item = rnd(1,turnplate.restaraunts.length);
		//奖品数量等于10,指针落在对应奖品区域的中心角度[252, 216, 180, 144, 108, 72, 36, 360, 324, 288]
		rotateFn(item, turnplate.restaraunts[item-1]);
		//  switch (item) {
		// 	case 1:
		// 		rotateFn(252, turnplate.restaraunts[0]);
		// 		break;
		// 	case 2:
		// 		rotateFn(216, turnplate.restaraunts[1]);
		// 		break;
		// 	case 3:
		// 		rotateFn(180, turnplate.restaraunts[2]);
		// 		break;
		// 	case 4:
		// 		rotateFn(144, turnplate.restaraunts[3]);
		// 		break;
		// 	case 5:
		// 		rotateFn(108, turnplate.restaraunts[4]);
		// 		break;
		// 	case 6:
		// 		rotateFn(72, turnplate.restaraunts[5]);
		// 		break;
		// 	case 7:
		// 		rotateFn(36, turnplate.restaraunts[6]);
		// 		break;
		// 	case 8:
		// 		rotateFn(360, turnplate.restaraunts[7]);
		// 		break;
		// 	case 9:
		// 		rotateFn(324, turnplate.restaraunts[8]);
		// 		break;
		// 	case 10:
		// 		rotateFn(288, turnplate.restaraunts[9]);
		// 		break;
		// }
		console.log(item);
	});
});

function rnd(n, m){

	n=1;//最小随机数
	m=100;//最大随机数（概率范围最大值）
	//最大数数不超过最大随机数
	var ransluck = [10,20,30,40,50,60,70,80,90,100];//概率为比自己小的第一个数之间的差
	var randoms = Math.floor(Math.random()*(m-n+1)+n);
	if(randoms<=ransluck[0])
	{
		var random = 1;
	}
	else if(randoms<=ransluck[1])
	{
		var random = 2;
	}
	else if(randoms<=ransluck[2])
	{
		var random = 3;
	}
	else if(randoms<=ransluck[3])
	{
		var random = 4;
	}
	else if(randoms<=ransluck[4])
	{
		var random = 5;
	}
	else if(randoms<=ransluck[5])
	{
		var random = 6;
	}
	else if(randoms<=ransluck[6])
	{
		var random = 7;
	}
	else if(randoms<=ransluck[7])
	{
		var random = 8;
	}
	else if(randoms<=ransluck[8])
	{
		var random = 9;
	}
	else if(randoms<=ransluck[9])
	{
		var random = 10;
	}
	//alert(randoms);
	//alert(random);
	return random;
	
}


//页面所有元素加载完毕后执行drawRouletteWheel()方法对转盘进行渲染
window.onload=function(){
	drawRouletteWheel();
};

function drawRouletteWheel() {    
  var canvas = document.getElementById("wheelcanvas");    
  if (canvas.getContext) {
	  //根据奖品个数计算圆周角度
	  var arc = Math.PI / (turnplate.restaraunts.length/2);
	  var ctx = canvas.getContext("2d");
	  //在给定矩形内清空一个矩形
	  ctx.clearRect(0,0,422,422);
	  //strokeStyle 属性设置或返回用于笔触的颜色、渐变或模式  
	  ctx.strokeStyle = "#FFBE04";
	  //font 属性设置或返回画布上文本内容的当前字体属性
	  ctx.font = '16px Microsoft YaHei';      
	  for(var i = 0; i < turnplate.restaraunts.length; i++) {       
		  var angle = turnplate.startAngle + i * arc;
		  ctx.fillStyle = turnplate.colors[i];
		  ctx.beginPath();
		  //arc(x,y,r,起始角,结束角,绘制方向) 方法创建弧/曲线（用于创建圆或部分圆）    
		  ctx.arc(211, 211, turnplate.outsideRadius, angle, angle + arc, false);    
		  ctx.arc(211, 211, turnplate.insideRadius, angle + arc, angle, true);
		  ctx.stroke();  
		  ctx.fill();
		  //锁画布(为了保存之前的画布状态)
		  ctx.save();   
		  
		  //----绘制奖品开始----
		  ctx.fillStyle = "#E5302F";
		  var text = turnplate.restaraunts[i];
		  var line_height = 17;
		  //translate方法重新映射画布上的 (0,0) 位置
		  ctx.translate(211 + Math.cos(angle + arc / 2) * turnplate.textRadius, 211 + Math.sin(angle + arc / 2) * turnplate.textRadius);
		  
		  //rotate方法旋转当前的绘图
		  ctx.rotate(angle + arc / 2 + Math.PI / 2);
		  
		  /** 下面代码根据奖品类型、奖品名称长度渲染不同效果，如字体、颜色、图片效果。(具体根据实际情况改变) **/
		  if(text.indexOf("M")>0){//流量包
			  var texts = text.split("M");
			  for(var j = 0; j<texts.length; j++){
				  ctx.font = j == 0?'bold 20px Microsoft YaHei':'16px Microsoft YaHei';
				  if(j == 0){
					  ctx.fillText(texts[j]+"M", -ctx.measureText(texts[j]+"M").width / 2, j * line_height);
				  }else{
					  ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height);
				  }
			  }
		  }else if(text.indexOf("M") == -1 && text.length>6){//奖品名称长度超过一定范围 
			  text = text.substring(0,6)+"||"+text.substring(6);
			  var texts = text.split("||");
			  for(var j = 0; j<texts.length; j++){
				  ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height);
			  }
		  }else{
			  //在画布上绘制填色的文本。文本的默认颜色是黑色
			  //measureText()方法返回包含一个对象，该对象包含以像素计的指定字体宽度
			  ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
		  }
		  
		  //添加对应图标
		  if(text.indexOf("分")>0){
			  var img= document.getElementById("fen-img");
			  img.onload=function(){  
				  ctx.drawImage(img,-15,10);      
			  }; 
			  ctx.drawImage(img,-15,10);  
		  }else if(text.indexOf("足疗")>=0){
			  var img= document.getElementById("zuliao-img");
			  img.onload=function(){  
				  ctx.drawImage(img,-15,10);      
			  };  
			  ctx.drawImage(img,-15,10);  
		  }
		  else if(text.indexOf("保温")>=0){
			  var img= document.getElementById("baowen-img");
			  img.onload=function(){
				  ctx.drawImage(img,-15,10);
			  };
			  ctx.drawImage(img,-15,10);
		  }
		  else if(text.indexOf("电熨斗")>=0){
			  var img= document.getElementById("yundou-img");
			  img.onload=function(){
				  ctx.drawImage(img,-15,10);
			  };
			  ctx.drawImage(img,-15,10);
		  }
		  else if(text.indexOf("橄榄")>=0){
			  var img= document.getElementById("ganlan-img");
			  img.onload=function(){
				  ctx.drawImage(img,-15,10);
			  };
			  ctx.drawImage(img,-15,10);
		  }
		  else if(text.indexOf("雨伞")>=0){
			  var img= document.getElementById("yusan-img");
			  img.onload=function(){
				  ctx.drawImage(img,-15,10);
			  };
			  ctx.drawImage(img,-15,10);
		  }

		  //把当前画布返回（调整）到上一个save()状态之前 
		  ctx.restore();
		  //----绘制奖品结束----
	  }     
  } 
}

</script>
</body>
</html>